<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="assets/css/style.css">
    <script type="text/javascript" src="build/nes.js"></script>
    <script type="text/javascript">
    document.addEventListener('DOMContentLoaded', function () {
    const fullscreenButton = document.getElementById('fullscreenButton');

if (fullscreenButton) {
    fullscreenButton.addEventListener('click', toggleFullscreen);
}

  });

      var nes;

      function init() {
        document.getElementById('loadROMButton').disabled = false;
        document.getElementById('dumpROMButton').disabled = true;
        document.getElementById('dumpRegButton').disabled = true;
        document.getElementById('dumpRAMButton').disabled = true;
        document.getElementById('dumpVRAMButton').disabled = true;
        document.getElementById('dumpSPRRAMButton').disabled = true;
        document.getElementById('stopButton').disabled = true;
        document.getElementById('stepButton').disabled = true;
        document.getElementById('resumeButton').disabled = true;
      }

      function ROMloaded() {
        document.getElementById('loadROMButton').disabled = true;
        document.getElementById('dumpROMButton').disabled = true;
        document.getElementById('dumpRegButton').disabled = true;
        document.getElementById('dumpRAMButton').disabled = true;
        document.getElementById('dumpVRAMButton').disabled = true;
        document.getElementById('dumpSPRRAMButton').disabled = true;
        document.getElementById('stopButton').disabled = true;
        document.getElementById('stepButton').disabled = true;
        document.getElementById('resumeButton').disabled = true;
      }

      function NESran() {
        document.getElementById('loadROMButton').disabled = true;
        document.getElementById('dumpROMButton').disabled = true;
        document.getElementById('dumpRegButton').disabled = true;
        document.getElementById('dumpRAMButton').disabled = true;
        document.getElementById('dumpVRAMButton').disabled = true;
        document.getElementById('dumpSPRRAMButton').disabled = true;
        document.getElementById('stopButton').disabled = false;
        document.getElementById('stepButton').disabled = true;
        document.getElementById('resumeButton').disabled = true;
      }

      function NESstopped() {
        document.getElementById('loadROMButton').disabled = true;
        document.getElementById('dumpROMButton').disabled = false;
        document.getElementById('dumpRegButton').disabled = false;
        document.getElementById('dumpRAMButton').disabled = false;
        document.getElementById('dumpVRAMButton').disabled = false;
        document.getElementById('dumpSPRRAMButton').disabled = false;
        document.getElementById('stopButton').disabled = true;
        document.getElementById('stepButton').disabled = false;
        document.getElementById('resumeButton').disabled = false;
      }

      function loadRom() {
        var url = document.getElementById('romList').selectedOptions[0].value;
        unloadROMButton.disabled = false;

        var request = new XMLHttpRequest();
        request.responseType = 'arraybuffer';

        request.onload = function() {
          putMessage('Loading done.');
          run(request.response);
        };

        request.onerror = function(e) {
          putMessage('failed to load.');
        };

        request.open('GET', url, true);
        request.send(null);

        putMessage('')
        putMessage('Loading rom image...')
        ROMloaded();
      }

      function unloadRom() {
        location.reload(); 
    }

      function run(buffer) {
        try {
          var rom = new NesJs.Rom(buffer);
        } catch(e) {
          putMessage('');
          putMessage(e.toString());
          return;
        }

        putMessage('');
        putMessage('Rom Header info');
        putMessage(rom.header.dump());

        nes = new NesJs.Nes();

        nes.addEventListener('fps', function(fps) {
          document.getElementById('fps').innerText = fps.toFixed(2);
        });

        nes.setRom(rom);

        nes.setDisplay(new NesJs.Display(document.getElementById('mainCanvas')));

        try {
    nes.setAudio(new NesJs.Audio());
  } catch(e) {
    putMessage('');
    putMessage('Disables audio because this browser does not seems to support WebAudio.');
  }

        window.onkeydown = function(e) { nes.handleKeyDown(e); };
        window.onkeyup = function(e) { nes.handleKeyUp(e); };

        putMessage('');

        putMessage('bootup.');
        nes.bootup();

        putMessage('runs.');
        NESran();
        nes.run();
      }

      function putMessage(str) {
        var area = document.getElementById('dump');
        area.firstChild.appendData(str + '\n');
        area.scrollTop = area.scrollHeight;
      }

      function pushDumpROM() {
        putMessage(nes.dumpRom());
      }

      function pushDumpReg() {
        putMessage(nes.dumpCpu());
        putMessage(nes.dumpPpu());
      }

      function pushDumpRAM() {
        putMessage(nes.dumpRam());
      }

      function pushDumpVRAM() {
        putMessage(nes.dumpVRam());
      }

      function pushDumpSPRRAM() {
        putMessage(nes.dumpSprRam());
      }

      function pushStopButton() {
        nes.stop();
        putMessage('stopped.');
        NESstopped();
      }

      function pushStepButton() {
        nes.runStep();
        putMessage(nes.dumpCpu());
      }

      function pushResumeButton() {
        nes.resume();
        putMessage('resumed.');
        NESran();
      }

      function pressPadButton(key) {
        if(nes === undefined)
          return;

        nes.pad1.pressButton(key);
      }

      function releasePadButton(key) {
        if(nes === undefined)
          return;

        nes.pad1.releaseButton(key);
      }

      function dragOverHandler(e) {
        e.preventDefault();
      }

      function dropHandler(e) {
        e.preventDefault();

        var reader = new FileReader();

        reader.onload = function(e) {
          putMessage('Loading done.');
          run(e.target.result);
        };

        reader.onerror = function(e) {
          for(var key in reader.error) {
            putMessage(key + '=' + reader.error[key]);
          }
        };

        reader.readAsArrayBuffer(e.dataTransfer.files[0]);

        putMessage('')
        putMessage('Loading rom image...')
      }

      window.addEventListener('drop', dropHandler, false);
      window.addEventListener('dragover', dragOverHandler, false);

      function toggleFullscreen() {
    const canvas = document.getElementById('mainCanvas');

    if (document.fullscreenElement || document.mozFullScreenElement ||
        document.webkitFullscreenElement || document.msFullscreenElement) {
        exitFullscreen(canvas);
    } else {
        requestFullscreen(canvas);
    }
}

function requestFullscreen(element) {
    if (element.requestFullscreen) {
        element.requestFullscreen();
    } else if (element.mozRequestFullScreen) {
        element.mozRequestFullScreen();
    } else if (element.webkitRequestFullscreen) {
        element.webkitRequestFullscreen();
    } else if (element.msRequestFullscreen) {
        element.msRequestFullscreen();
    }
}

function exitFullscreen(element) {
    if (document.exitFullscreen) {
        document.exitFullscreen();
    } else if (document.mozCancelFullScreen) {
        document.mozCancelFullScreen();
    } else if (document.webkitExitFullscreen) {
        document.webkitExitFullscreen();
    } else if (document.msExitFullscreen) {
        document.msExitFullscreen();
    }
}
    </script>
    <title>ShouryuGames</title>
</head>
<body>
    <header>
        <div class="container">
          <nav>
            <div class="logo">
              <a href="/">
                <img src="assets/images/logo.png" alt="" />
                <h2><span>S</span>houryu<span>GAMES</span></h2>
              </a>
            </div>
            <ul>
              <div class="btn">
                <i class="fas fa-times close-btn"></i>
              </div>
              <li><a href="/">Home</a></li>
              <li><a href="/games">Games</a></li>
              <li><a href="/library">Library</a></li>
              <li><a href="/account">Account</a></li>
            </ul>
            <div class="btn">
              <i class="fas fa-bars menu-btn"></i>
            </div>
                <h4 class="user-cash"><span>Monto: </span>0$</h4>
          </nav>
        </div>
      </header>